from proof_explainer import ProofExplainer

explainer = ProofExplainer(model_name="deepseek-v3.1:671b-cloud")


def show_test(steps: list):
    print("\nВходные шаги доказательства:")
    for i, step in enumerate(steps, 1):
        print(f"   {i}. {step}")

    print("\nГенерируется объяснение...\n")
    explanation = explainer.explain_proof(steps)

    print("Объяснение на естественном языке:")
    print("-" * 70)
    print(explanation)
    print("=" * 80 + "\n")


# ===================================================================
# 1. Сократ смертен
# ===================================================================
def test_socrates_mortal():
    print("1. КЛАССИЧЕСКИЙ СИЛЛОГИЗМ: Сократ — человек → Сократ смертен")
    print("=" * 70)
    steps = [
        "Шаг 1: Унификация {x/Сократ} в ¬Человек(x) ∨ Смертен(x)",
        "Шаг 2: Резолюция с Человек(Сократ) → получаем Смертен(Сократ)",
        "Шаг 3: Резолюция Смертен(Сократ) и ¬Смертен(Сократ) → Пустая клауза (противоречие)"
    ]
    show_test(steps)


# ===================================================================
# 2 Джон лжёт → Джон нечестный
# ===================================================================
def test_john_liar():
    print("2. ДЖОН ЛЖЁТ → Джон нечестный")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Честный(x) ∨ ГоворитПравду(x)",
        "Шаг 2: ¬ГоворитПравду(Джон)",
        "Шаг 3: Резолюция → ¬Честный(Джон)",
        "Шаг 4: Резолюция с Честный(Джон) → Противоречие"
    ]
    show_test(steps)


# ===================================================================
# 3 Пингвин не летает → Пингвин не птица
# ===================================================================
def test_penguin_not_bird():
    print("3. ПИНГВИН НЕ ЛЕТАЕТ → Пингвин не птица")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Птица(x) ∨ Летает(x)",
        "Шаг 2: ¬Летает(Пингвин)",
        "Шаг 3: Резолюция → ¬Птица(Пингвин)",
        "Шаг 4: Резолюция с Птица(Пингвин) → Противоречие"
    ]
    show_test(steps)


# ===================================================================
# 4 Не сдал экзамен → Не готовился
# ===================================================================
def test_contraposition_exam():
    print("4. MODUS TOLLENS: Не сдал экзамен → Не готовился")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Подготовился(x) ∨ СдалЭкзамен(x)",
        "Шаг 2: ¬СдалЭкзамен(Петя)",
        "Шаг 3: Резолюция → ¬Подготовился(Петя)",
        "Шаг 4: Резолюция с Подготовился(Петя) → Противоречие"
    ]
    show_test(steps)


# ===================================================================
# 5 Только Маша — отличница
# ===================================================================
def test_only_masha():
    print("5. «ТОЛЬКО МАША» сдала на 5 → только Маша отличница")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Отличник(x) ∨ СдалНа5(x)",
        "Шаг 2: ¬СдалНа5(y) ∨ y = Маша",
        "Шаг 3: СдалНа5(Маша)",
        "Шаг 4: Резолюции доказывают ∀x (Отличник(x) ↔ x = Маша)"
    ]
    show_test(steps)


# ===================================================================
# 6 Закон де Моргана
# ===================================================================
def test_de_morgan_wizard():
    print("6. ЗАКОН ДЕ МОРГАНА: волшебник не может быть одновременно магом и колдуном")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Волшебник(x) ∨ ¬Маг(x) ∨ ¬Колдун(x)",
        "Шаг 2: Волшебник(Мерлин)",
        "Шаг 3: Резолюция → ¬Маг(Мерлин) ∨ ¬Колдун(Мерлин)",
        "Шаг 4: Отрицание цели Маг(Мерлин) ∧ Колдун(Мерлин) → противоречие"
    ]
    show_test(steps)


# ===================================================================
# 7 Цепочка импликаций:================================================================
def test_rain_accidents_chain():
    print("7. Дождь → Мокрые улицы → Скользко → Аварии")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Дождь ∨ МокрыеУлицы",
        "Шаг 2: ¬МокрыеУлицы ∨ СкользятМашины",
        "Шаг 3: ¬СкользятМашины ∨ Аварии",
        "Шаг 4: Дождь",
        "Шаг 5: Последовательные резолюции → Аварии",
        "Шаг 6: Резолюция с ¬Аварии → Противоречие"
    ]
    show_test(steps)


# ===================================================================
# 8 Рыцари и лжецы — только Ланселот знает правду
# ===================================================================
def test_knights_liars_lancelot():
    print("8. Только Ланселот знает правду → он не лжёт")
    print("=" * 70)
    steps = [
        "Шаг 1: Рыцарь(x) → ¬Лжёт(x)",
        "Шаг 2: Лжёт(x) → ¬Рыцарь(x)",
        "Шаг 3: ЗнаетПравду(x) → ¬Лжёт(x)",
        "Шаг 4: ∀y (y ≠ Ланселот → ¬ЗнаетПравду(y))",
        "Шаг 5: ЗнаетПравду(Ланселот)",
        "Шаг 6: Доказываем ¬Лжёт(Ланселот)"
    ]
    show_test(steps)


# ===================================================================
# 9 Транзитивность отношения
# ===================================================================
def test_transitivity_age():
    print("9. ТРАНЗИТИВНОСТЬ: Маша > Катя > Лена → Маша > Лена")
    print("=" * 70)
    steps = [
        "Шаг 1: ¬Старше(x,y) ∨ ¬Старше(y,z) ∨ Старше(x,z)",
        "Шаг 2: Старше(Маша, Катя)",
        "Шаг 3: Старше(Катя, Лена)",
        "Шаг 4: Резолюции → Старше(Маша, Лена)",
        "Шаг 5: Резолюция с ¬Старше(Маша, Лена) → Противоречие"
    ]
    show_test(steps)



# ===================================================================
# ЗАПУСК
# ===================================================================
if __name__ == "__main__":
    print("\n" + " ТЕСТЫ ДЛЯ ProofExplainer — ОБЪЯСНЕНИЕ ДОКАЗАТЕЛЬСТВ ".center(80, "=") + "\n")

    test_socrates_mortal()
    test_john_liar()
    test_penguin_not_bird()
    test_contraposition_exam()
    test_only_masha()
    test_de_morgan_wizard()
    test_rain_accidents_chain()
    test_knights_liars_lancelot()
    test_transitivity_age()

    print("═" * 80)
    print("               ВСЕ ТЕСТЫ PROOFEXPLAINER ЗАВЕРШЕНЫ")
    print("═" * 80)